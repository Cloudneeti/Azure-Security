# Configuring Monitoring and Alerting using OMS
Use the information and procedure described in this section to configure Azure activity log analytics using Operation Management Suite (OMS).
<br />
<br />

OMS provides an analysis and reporting function so that you can monitor the performance and security health of your system. You will recieve logs and alerts on system events related to the resources that host your systems. These are system-generated notifications provided in real-time. 

Use a proactive approach when monitoring. Audit your resources to identify systems that do not meet organizational standards or best practices.

OMS provides:
- OMS Log Analytics
- OMS Security and Compliance Solution
- OMS Network Performance Monitor (NPM)
<br />
<br />

Use the following security tools/features to monitor and audit your network: 

 [OMS Log Analytics](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-overview?toc=%2fazure%2foperations-management-suite%2ftoc.json):  
 Use this feature to obtain detailed insights into the activities occuring in your Azure environment.   
 With log analytics you can:  
- use its [query language](https://docs.loganalytics.io/index) to quickly retrieve, consolidate, analyze and create [security alerts](https://docs.microsoft.com/en-us/azure/security-center/security-center-managing-and-responding-alerts) based on data collected from Azure resources across multiple subscriptions.  
     
- identify malware using the [Malware Assessment](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-malware?toc=%2fazure%2foperations-management-suite%2ftoc.json) 
- monitor your networks using the [Azure Application Gateway Analytics](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-azure-networking-analytics?toc=%2fazure%2foperations-management-suite%2ftoc.json#azure-application-gateway-analytics-solution-in-log-analytics) solution 
- monitor your network security group using the [Azure Network Security Group Analytics](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-azure-networking-analytics?toc=%2fazure%2foperations-management-suite%2ftoc.json#azure-network-security-group-analytics-solution-in-log-analytics) solution
- use [Activity Log Analytics](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-activity) to see operational activities aggregated by status. You can monitor Azure resource activity trends as well as identify resource service health issues or outages.
<br />

[OMS Security and Compliance Solution](https://docs.microsoft.com/en-us/azure/operations-management-suite/oms-security-getting-started#oms-security-and-audit-dashboard):  
  Your IT group can use this feature to actively monitor all resources with an objective to minimize the impact of security incidents.  
  OMS Security and Audit has security domains that can be used for monitoring resources. The [Security and Audit Dashboard](https://docs.microsoft.com/en-us/azure/operations-management-suite/oms-security-getting-started#oms-security-and-audit-dashboard) is the home screen for everything related to security in OMS. It provides high-level insight into the security state of your computers. It also includes the ability to view all events from the past 24 hours, 7 days, or any other custom time frame.
<br />
<br />

[OMS Network Performance Monitor (NPM)](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-network-performance-monitor):  
  This suite provides various capabilities to monitor the health of your network, network performance and network connectivity to your applications. NPM is cloud-based and provides a hybrid network monitoring solution that monitors connectivity between:   
- Cloud deployments and on-premises locations  
- Multiple data centers and branch offices  
- Mission critical multi-tier applications/micro-services  
- User locations and web-based applications (HTTP/HTTPs)   

   Monitoring capabilities include:  
- [Performance Monitor](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-network-performance-monitor-performance-monitor)  
- [ExpressRoute Monitor](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-network-performance-monitor-expressroute)   
- [Service Endpoint Monitor](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-network-performance-monitor-service-endpoint). 
<br />
<br />

## Guidance

- Enable [Diagnostic Logging to Stream logs to Log Analytics](https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitor-stream-diagnostic-logs-log-analytics) for detailed analysis  

 - Understand Log Searches in Log Analytics.  
 For example:  
   - [where log searches are used](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-log-search#where-log-searches-are-used)
   - [how data is organized](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-log-search#how-log-analytics-data-is-organized)
   - [how to write a query](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-log-search#writing-a-query)
   
- When creating monitoring rules, disable the default rule and create custom monitoring rules. Custom monitoring rules can reduce the traffic generated by the solution and help optimize network monitoring (**Note**: relevant for large networks that use a large number of nodes for monitoring). 

- When configuring Network Performance Monitor, create a network that groups subnets. Use this grouping method instead of the default setting (creates the default network and all of the subnets in your environment). 
- When choosing a protocol, use TCP for monitoring.  
-  Use ICMP instead of TCP in the following cases:  
    - you use Windows client-based nodes (TCP raw sockets aren't allowed in Windows clients) 
    - your network firewall or NSG blocks TCP 
    - you don't know how to switch the protocol 
<br />
<br />

## Preparation 
Ensure you perform the following prior to using the procedures:   
  - obtain an Azure and an Office 365 subscription 
  
  - you are assigned as the Subscription Owner for both Azure and Office 365 
  - enable [diagnostic logging](https://docs.microsoft.com/en-us/azure/cdn/cdn-azure-diagnostic-logs#enable-logging-with-azure-portal) for your Azure resources
<br />
<br />

## Procedure:  How to configure OMS Azure activity log analytics

1. **Create a OMS Workspace**:  
  Create an OMS workspace so you can add your Log Analytics Solution, see: [Create an OMS Workspace](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-quick-create-workspace).  

 2. **Add the Azure activity log analytics solution**:  
  Use the following link to add the Azure Log Analytics Solution to your workspace, see: [Add the Azure Activity log Analytics](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-activity#configuration) solution.

3. **Configure OMS workspace for log analytics**:  
  See: [Configuring your OMS Workspace for Azure Log Analytics](/nmcgregor/Azure-Security/blob/master/4.3.1-Configuring-OMS-Workspace-for-Azure-Log-Analytics.md)  

4. **Create alerts with log analytics**:   
  Create alerts based on specific performance metrics or when certain events are created, absence of an event, or a number of events are created within a particular time window.   
  
   For further information, see: [Create alerts with log analytics](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-tutorial-response#create-alerts) and use the [Top 10 Alerts for Azure Active Directory](4.3.2-Top-10-Alerts-For-Azure-Active-Directory.md), [Top 5 Alerts for Azure Networking Operations](4.3.3-Top-5-Alerts-for-Azure-Networking-Operations.md), and [Top 10 Alerts for Subscriptions](4.3.4-Top-10-Alerts-For-Subscriptions.md) as a baseline when creating your alerts.

5. **Create alert actions with log analytics**:   
  When alert criteria are met:  
   - Create e-mail notifications
   - Launch an Automation Runbook  
   - Create incident records  
  
   For further information, see: [Create alert actions with log analytics](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-tutorial-response#alert-actions). 
<br />
<br />


## Procedure:  How to configure OMS security and compliance

1. **Create an OMS workspace**:   
  Create an OMS workspace so you can add your Log Analytics Solution, see: [Create an OMS Workspace](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-quick-create-workspace).  
   
2. **Add the security and compliance solution**:  
   Use the following link to add the Security and Compliance solution to your workspace, see: [Add the Security and Compliance](https://docs.microsoft.com/en-us/azure/operations-management-suite/oms-security-getting-started?toc=%2fazure%2flog-analytics%2ftoc.json#oms-security-and-audit-dashboard) solution.
<br />
<br />

## Procedure:  How to configure OMS Network Performance Monitor
1. **Create an OMS workspace**:  
   Create an OMS workspace so you can add your Log Analytics Solution, see: [Create an OMS Workspace](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-quick-create-workspace).  
   
2. **Add the Network Performance Monitor solution**:  
  Use the following link to add the Network Performance Monitor solution to your workspace, see: [Add the Network Performance Monitor](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-network-performance-monitor#configure-the-solution).
   
3. **Configure the capabilities you want**:
   - [Performance Monitor](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-network-performance-monitor-performance-monitor#configuration)
   - [Service Endpoint Monitor](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-network-performance-monitor-performance-monitor#configuration)
   - [ExpressRoute Monitor](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-network-performance-monitor-expressroute#configuration)
<br />
<br />   

## Next steps
[Implementing Azure Business Continuity and Disaster Recovery](4.4-Implementing-Azure-Business-Continuity-and-Disaster-Recovery.md)
